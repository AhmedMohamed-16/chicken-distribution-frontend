<div class="backup-restore-container">
  <h3>ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ</h3>
  <p class="description">
    ูู ุจุฑูุน ููู ูุณุฎุฉ ุงุญุชูุงุทูุฉ (ZIP) ูุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช. ุงุฎุชุฑ ุทุฑููุฉ ุงูุงุณุชุนุงุฏุฉ ุจุนูุงูุฉ.
  </p>

  <!-- ุฑุณุงูุฉ ุฎุทุฃ -->
  @if (error()) {
    <app-error-message
      [message]="error()"
      (dismiss)="dismissError()">
    </app-error-message>
  }

  <!-- ูููุฐุฌ ุงูุงุณุชุนุงุฏุฉ -->
  <div class="restore-form">
    <!-- ุฑูุน ุงูููู -->
    <div class="form-group">
      <label for="backupFile" class="form-label">
        ุงุฎุชุฑ ููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ (ZIP ููุท):
      </label>
      <input
        type="file"
        id="backupFile"
        accept=".zip"
        (change)="onFileSelected($event)"
        [disabled]="restoring()"
        class="file-input"
        aria-label="ุงุฎุชูุงุฑ ููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ">
      @if (selectedFile()) {
        <div class="file-info">
          <span class="file-name">{{ selectedFile()!.name }}</span>
          <span class="file-size">({{ getFileSize() }})</span>
        </div>
      }
    </div>

    <!-- ุงุฎุชูุงุฑ ุทุฑููุฉ ุงูุงุณุชุนุงุฏุฉ -->
    <div class="form-group">
      <label class="form-label">ุทุฑููุฉ ุงูุงุณุชุนุงุฏุฉ:</label>
      <div class="radio-group">
        <label class="radio-label">
          <input
            type="radio"
            name="strategy"
            [value]="'append'"
            [(ngModel)]="strategy"
            [disabled]="restoring()">
          <span class="radio-text">
            <strong>ุฅุถุงูุฉ / ุชุญุฏูุซ ุงูุจูุงูุงุช</strong>
            <span class="radio-description">
              ุฅุถุงูุฉ ุงูุณุฌูุงุช ุงูุฌุฏูุฏุฉ ูุชุญุฏูุซ ุงูุณุฌูุงุช ุงูุญุงููุฉ. ุงูุฎูุงุฑ ุงูุฃูุซุฑ ุฃูุงููุง.
            </span>
          </span>
        </label>

        <label class="radio-label">
          <input
            type="radio"
            name="strategy"
            [value]="'replace'"
            [(ngModel)]="strategy"
            [disabled]="restoring()">
          <span class="radio-text">
            <strong>ุงุณุชุจุฏุงู ุฌููุน ุงูุจูุงูุงุช</strong>
            <span class="radio-description danger">
              โ๏ธ ุณูุชู ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงูุญุงููุฉ ุฃูููุง. ุงุณุชุฎุฏู ูุฐุง ุงูุฎูุงุฑ ุจุญุฐุฑ ุดุฏูุฏ!
            </span>
          </span>
        </label>
      </div>
    </div>

    <!-- ุฒุฑ ุงูุงุณุชุนุงุฏุฉ -->
    <button
      class="btn btn-restore"
      (click)="initiateRestore()"
      [disabled]="!selectedFile() || restoring()"
      aria-label="ุจุฏุก ุงูุงุณุชุนุงุฏุฉ">
      @if (restoring()) {
        <app-loading-spinner [inline]="true"></app-loading-spinner>
        <span>ุฌุงุฑู ุงูุงุณุชุนุงุฏุฉ... {{ uploadProgress() }}%</span>
      } @else {
        <span>๐ ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช</span>
      }
    </button>
  </div>

  <!-- ูุงูุฐุฉ ุงูุชุฃููุฏ -->
  @if (showConfirmation()) {
    <div class="modal-overlay" (click)="cancelRestore()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h4>ุชุฃููุฏ ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช</h4>
        </div>
        <div class="modal-body">
          <div class="warning-box">
            <p>{{ getWarningMessage() }}</p>
          </div>
          <p><strong>ุงูููู:</strong> {{ selectedFile()!.name }}</p>
          <p>
            <strong>ุงูุทุฑููุฉ:</strong>
            {{ strategy() === 'replace' ? 'ุงุณุชุจุฏุงู ุฌููุน ุงูุจูุงูุงุช' : 'ุฅุถุงูุฉ / ุชุญุฏูุซ ุงูุจูุงูุงุช' }}
          </p>

          <div class="confirmation-checkbox">
            <label>
              <input type="checkbox" #confirmCheck>
              ุฃูุฑ ุจุฃููู ุฃููู ุฃู ูุฐุง ุงูุฅุฌุฑุงุก ุณูุนุฏู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุง ูููู ุงูุชุฑุงุฌุน ุนูู
            </label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-cancel" (click)="cancelRestore()">
            ุฅูุบุงุก
          </button>
          <button
            class="btn btn-confirm"
            [class.btn-danger]="strategy() === 'replace'"
            [disabled]="!confirmCheck.checked"
            (click)="confirmRestore()">
            {{ strategy() === 'replace' ? 'ูุนูุ ุญุฐู ูุงุณุชุจุฏุงู' : 'ูุนูุ ุชูููุฐ ุงูุงุณุชุนุงุฏุฉ' }}
          </button>
        </div>
      </div>
    </div>
  }

  <!-- ูุชุงุฆุฌ ุงูุงุณุชุนุงุฏุฉ -->
  @if (restoreResult(); as result) {
    <div class="restore-results">
      <h4>โ ุชูุช ุงูุงุณุชุนุงุฏุฉ ุจูุฌุงุญ</h4>
      <div class="results-grid">
        <div class="result-item">
          <span class="result-label">ุงูุทุฑููุฉ:</span>
          <span class="result-value">{{ result.strategy }}</span>
        </div>
        <div class="result-item">
          <span class="result-label">ุงููุฏุฉ:</span>
          <span class="result-value">{{ result.duration }}</span>
        </div>
        <div class="result-item">
          <span class="result-label">ุนุฏุฏ ุงูุฌุฏุงูู ุงูุชู ุชูุช ูุนุงูุฌุชูุง:</span>
          <span class="result-value">{{ result.tablesProcessed }}</span>
        </div>
        <div class="result-item">
          <span class="result-label">ุนุฏุฏ ุงูุณุฌูุงุช ุงููุถุงูุฉ:</span>
          <span class="result-value success">{{ result.totalInserted }}</span>
        </div>
        <div class="result-item">
          <span class="result-label">ุนุฏุฏ ุงูุณุฌูุงุช ุงููุญุฏุซุฉ:</span>
          <span class="result-value success">{{ result.totalUpdated }}</span>
        </div>
        <div class="result-item">
          <span class="result-label">ุนุฏุฏ ุงูุฃุฎุทุงุก:</span>
          <span class="result-value" [class.error]="result.totalErrors > 0">
            {{ result.totalErrors }}
          </span>
        </div>
      </div>
    </div>
  }
</div>
