<!-- <div class="container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</mat-card-title>
      <mat-card-subtitle>Ø¹Ø±Ø¶ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="dateForm" (ngSubmit)="loadReport()">
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Ù…Ù† ØªØ§Ø±ÙŠØ®</mat-label>
            <input matInput [matDatepicker]="pickerFrom" formControlName="from">
            <mat-datepicker-toggle matSuffix [for]="pickerFrom"></mat-datepicker-toggle>
            <mat-datepicker #pickerFrom></mat-datepicker>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</mat-label>
            <input matInput [matDatepicker]="pickerTo" formControlName="to">
            <mat-datepicker-toggle matSuffix [for]="pickerTo"></mat-datepicker-toggle>
            <mat-datepicker #pickerTo></mat-datepicker>
          </mat-form-field>

          <button mat-raised-button color="primary" type="submit" [disabled]="dateForm.invalid">
            Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
          </button>
        </div>
      </form>

      @if (loading()) {
      <div class="loading-spinner">
        <mat-spinner></mat-spinner>
      </div>
      } @else if (report()) {
      <div class="report-content">
         <div class="summary-section">
          <h3>Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h3>
          <div class="summary-grid">
            <div class="summary-card profit">
              <p class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</p>
              <p class="value">{{ report()!.totals.net_profit | number:'1.2-2' }} Ø¬</p>
            </div>
            <div class="summary-card">
              <p class="label">Ø§Ù„ÙØªØ±Ø©</p>
              <p class="value">
                {{ report()!.period.from }} - {{ report()!.period.to }}
              </p>
            </div>
            <div class="summary-card">
              <p class="label">Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡</p>
              <p class="value">{{ report()!.partner_totals.length || 0 }}</p>
            </div>
          </div>
        </div>

        @if (report()!.partner_totals && report()!.partner_totals.length > 0) {
        <div class="section">
          <h3>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡</h3>

          <table mat-table [dataSource]="report()!.partner_totals" class="details-table">

            <ng-container matColumnDef="partner_name">
              <th mat-header-cell *matHeaderCellDef>Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙŠÙƒ</th>
              <td mat-cell *matCellDef="let p">
                {{ p.partner_name }}
              </td>
            </ng-container>

            <ng-container matColumnDef="base_share">
              <th mat-header-cell *matHeaderCellDef>Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</th>
              <td mat-cell *matCellDef="let p" class="profit-amount">
                {{ p.total_base_share | number:'1.2-2' }} Ø¬
              </td>
            </ng-container>

            <ng-container matColumnDef="vehicle_cost">
              <th mat-header-cell *matHeaderCellDef>Ø®ØµÙ… Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</th>
              <td mat-cell *matCellDef="let p" class="profit-amount">
                {{ p.total_vehicle_cost_share | number:'1.2-2' }} Ø¬
              </td>
            </ng-container>

            <ng-container matColumnDef="final_profit">
              <th mat-header-cell *matHeaderCellDef>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</th>
              <td mat-cell *matCellDef="let p" class="profit-amount">
                {{ p.total_final_profit | number:'1.2-2' }} Ø¬
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="partnerColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: partnerColumns"></tr>

          </table>
        </div>
        }


        @if (report()!.daily_distributions && report()!.daily_distributions.length > 0) {
        <div class="section">
          <h3>Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
          <table mat-table [dataSource]="report()!.daily_distributions" class="details-table">
            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
              <td mat-cell *matCellDef="let daily">{{ daily.daily_operation.operation_date }}</td>
            </ng-container>

            <ng-container matColumnDef="net_profit">
              <th mat-header-cell *matHeaderCellDef>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</th>
              <td mat-cell *matCellDef="let daily" class="profit-amount" [class.negative]="daily.total_final_profit < 0">
                {{ daily.net_profit | number:'1.2-2' }} Ø¬
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="dailyColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: dailyColumns"></tr>
          </table>
        </div>
        }
      </div>
      }
    </mat-card-content>
  </mat-card>
</div> -->
<!-- ============================================================================ -->
<!-- PROFIT REPORT TEMPLATE - COMPLETE MULTI-VEHICLE REFACTORING -->
<!-- ============================================================================ -->
<!-- File: src/app/features/reports/profit-report/profit-report.html -->

<!-- <div class="container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</mat-card-title>
      <mat-card-subtitle>Ø¹Ø±Ø¶ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
       <form [formGroup]="dateForm" (ngSubmit)="loadReport()">
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Ù…Ù† ØªØ§Ø±ÙŠØ®</mat-label>
            <input matInput [matDatepicker]="pickerFrom" formControlName="from">
            <mat-datepicker-toggle matSuffix [for]="pickerFrom"></mat-datepicker-toggle>
            <mat-datepicker #pickerFrom></mat-datepicker>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</mat-label>
            <input matInput [matDatepicker]="pickerTo" formControlName="to">
            <mat-datepicker-toggle matSuffix [for]="pickerTo"></mat-datepicker-toggle>
            <mat-datepicker #pickerTo></mat-datepicker>
          </mat-form-field>

          <button mat-raised-button color="primary" type="submit" [disabled]="dateForm.invalid">
            <mat-icon>search</mat-icon>
            Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
          </button>
        </div>
      </form>

       @if (loading()) {
        <div class="loading-spinner">
          <mat-spinner></mat-spinner>
          <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...</p>
        </div>
      }

       @else if (report()) {
        <div class="report-content">

           @if (vehicles().length > 0) {
            <div class="vehicles-section">
              <h3>Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„ÙØªØ±Ø©</h3>
              <mat-chip-set>
                @for (vehicle of vehicles(); track vehicle.id) {
                  <mat-chip>
                    <mat-icon matChipAvatar>local_shipping</mat-icon>
                    {{ vehicle.name }} - {{ vehicle.plate_number }}
                  </mat-chip>
                }
              </mat-chip-set>
            </div>
          }

           @if (vehicles().length > 1) {
            <div class="filter-section">
              <mat-form-field appearance="outline" class="vehicle-filter">
                <mat-label>ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</mat-label>
                <mat-select
                  [value]="selectedVehicleId()"
                  (selectionChange)="onVehicleFilterChange($event.value)">
                  <mat-option [value]="null">
                    <mat-icon>list</mat-icon>
                    Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
                  </mat-option>
                  @for (vehicle of vehicles(); track vehicle.id) {
                    <mat-option [value]="vehicle.id">
                      <mat-icon>local_shipping</mat-icon>
                      {{ vehicle.name }}
                    </mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
          }

           <div class="summary-section">
            <h3>
              @if (selectedVehicleId()) {
                Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ - {{ getVehicleName(selectedVehicleId()) }}
              } @else {
                Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
              }
            </h3>
            <div class="summary-grid">
              <div class="summary-card profit">
                <mat-icon>trending_up</mat-icon>
                <p class="label">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</p>
                <p class="value">{{ filteredTotals()?.net_profit | number:'1.2-2' }} Ø¬</p>
              </div>
              <div class="summary-card revenue">
                <mat-icon>point_of_sale</mat-icon>
                <p class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</p>
                <p class="value">{{ filteredTotals()?.total_revenue | number:'1.2-2' }} Ø¬</p>
              </div>
              <div class="summary-card costs">
                <mat-icon>payments</mat-icon>
                <p class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</p>
                <p class="value">{{ filteredTotals()?.total_purchases | number:'1.2-2' }} Ø¬</p>
              </div>
              <div class="summary-card period">
                <mat-icon>calendar_today</mat-icon>
                <p class="label">Ø§Ù„ÙØªØ±Ø©</p>
                <p class="value">
                  {{ report()!.period.from }} - {{ report()!.period.to }}
                </p>
              </div>
              <div class="summary-card partners">
                <mat-icon>group</mat-icon>
                <p class="label">Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡</p>
                <p class="value">{{ filteredPartnerProfits().length || 0 }}</p>
              </div>
            </div>
          </div>

           @if (vehicles().length > 1 && !selectedVehicleId()) {
            <div class="vehicle-summaries-section">
              <h3>Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ù„ÙƒÙ„ Ù…Ø±ÙƒØ¨Ø©</h3>
              <div class="vehicle-cards-grid">
                @for (summary of vehicleSummaries(); track summary.vehicle.id) {
                  <mat-card class="vehicle-summary-card">
                    <mat-card-header>
                      <mat-card-title>
                        <mat-icon>local_shipping</mat-icon>
                        {{ summary.vehicle.name }}
                      </mat-card-title>
                      <mat-card-subtitle>{{ summary.vehicle.plate_number }}</mat-card-subtitle>
                    </mat-card-header>
                    <mat-card-content>
                      <div class="mini-summary">
                        <div class="mini-item">
                          <span class="mini-label">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª:</span>
                          <span class="mini-value">{{ summary.total_revenue | number:'1.2-2' }} Ø¬</span>
                        </div>
                        <div class="mini-item">
                          <span class="mini-label">Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª:</span>
                          <span class="mini-value">{{ summary.total_purchases | number:'1.2-2' }} Ø¬</span>
                        </div>
                        <div class="mini-item">
                          <span class="mini-label">Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ:</span>
                          <span class="mini-value">{{ summary.total_costs | number:'1.2-2' }} Ø¬</span>
                        </div>
                        <div class="mini-item profit-item">
                          <span class="mini-label">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­:</span>
                          <span class="mini-value profit">{{ summary.net_profit | number:'1.2-2' }} Ø¬</span>
                        </div>
                      </div>
                    </mat-card-content>
                    <mat-card-actions>
                      <button mat-button color="primary" (click)="onVehicleFilterChange(summary.vehicle.id)">
                        <mat-icon>visibility</mat-icon>
                        Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                      </button>
                    </mat-card-actions>
                  </mat-card>
                }
              </div>
            </div>
          }

           @if (filteredPartnerProfits().length > 0) {
            <div class="section">
              <h3>
                <mat-icon>group</mat-icon>
                ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡
                <span class="count-badge">({{ filteredPartnerProfits().length }})</span>
              </h3>

              <table mat-table [dataSource]="filteredPartnerProfits()" class="details-table">

                 @if (!selectedVehicleId() && vehicles().length > 1) {
                  <ng-container matColumnDef="vehicle">
                    <th mat-header-cell *matHeaderCellDef>Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</th>
                    <td mat-cell *matCellDef="let profit">
                      <mat-chip [class.shared-profit]="!profit.vehicle_id">
                        {{ getVehicleName(profit.vehicle_id) }}
                      </mat-chip>
                    </td>
                  </ng-container>
                }

                <ng-container matColumnDef="partner_name">
                  <th mat-header-cell *matHeaderCellDef>Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙŠÙƒ</th>
                  <td mat-cell *matCellDef="let profit">{{ profit.partner_name }}</td>
                </ng-container>

                <ng-container matColumnDef="base_share">
                  <th mat-header-cell *matHeaderCellDef>Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</th>
                  <td mat-cell *matCellDef="let profit" class="profit-amount">
                    {{ profit.total_base_share | number:'1.2-2' }} Ø¬
                  </td>
                </ng-container>

                <ng-container matColumnDef="vehicle_cost">
                  <th mat-header-cell *matHeaderCellDef>Ø®ØµÙ… Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</th>
                  <td mat-cell *matCellDef="let profit" class="cost-amount">
                    {{ profit.total_vehicle_cost_share | number:'1.2-2' }} Ø¬
                  </td>
                </ng-container>

                <ng-container matColumnDef="final_profit">
                  <th mat-header-cell *matHeaderCellDef>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</th>
                  <td mat-cell *matCellDef="let profit" class="final-profit-amount">
                    {{ profit.total_final_profit | number:'1.2-2' }} Ø¬
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="(selectedVehicleId() || vehicles().length <= 1) ? partnerColumns.slice(1) : partnerColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: (selectedVehicleId() || vehicles().length <= 1) ? partnerColumns.slice(1) : partnerColumns"></tr>
              </table>
            </div>
          }

           @if (filteredDailyDistributions().length > 0) {
            <div class="section">
              <h3>
                <mat-icon>calendar_month</mat-icon>
                Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
                <span class="count-badge">({{ filteredDailyDistributions().length }})</span>
              </h3>

              <table mat-table [dataSource]="filteredDailyDistributions()" class="details-table">

                 @if (!selectedVehicleId() && vehicles().length > 1) {
                  <ng-container matColumnDef="vehicle">
                    <th mat-header-cell *matHeaderCellDef>Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</th>
                    <td mat-cell *matCellDef="let daily">
                      <mat-chip [class.shared-daily]="!daily.vehicle_id">
                        {{ getVehicleName(daily.vehicle_id) }}
                      </mat-chip>
                    </td>
                  </ng-container>
                }

                <ng-container matColumnDef="date">
                  <th mat-header-cell *matHeaderCellDef>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                  <td mat-cell *matCellDef="let daily">{{ daily.operation_date }}</td>
                </ng-container>

                <ng-container matColumnDef="net_profit">
                  <th mat-header-cell *matHeaderCellDef>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</th>
                  <td mat-cell *matCellDef="let daily"
                      class="profit-amount"
                      [class.negative]="daily.net_profit < 0"
                      [class.positive]="daily.net_profit >= 0">
                    {{ daily.net_profit | number:'1.2-2' }} Ø¬
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="(selectedVehicleId() || vehicles().length <= 1) ? dailyColumns.slice(1) : dailyColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: (selectedVehicleId() || vehicles().length <= 1) ? dailyColumns.slice(1) : dailyColumns"></tr>
              </table>
            </div>
          }

           @if (filteredPartnerProfits().length === 0 && filteredDailyDistributions().length === 0) {
            <div class="empty-state">
              <mat-icon>inbox</mat-icon>
              <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</h3>
              <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø±Ø¨Ø§Ø­ Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p>
            </div>
          }

        </div>
      }

       @else {
        <div class="no-report-state">
          <mat-icon>calendar_today</mat-icon>
          <p>Ø§Ø®ØªØ± Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</p>
        </div>
      }

    </mat-card-content>
  </mat-card>
</div> -->
<!--
=========================
PROFIT REPORT TEMPLATE
=========================
-->
<!--
 <div class="profit-report-container">
   <div class="report-header">
    <h1>ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h1>
    <p class="subtitle">ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„ØªØ³Ø±Ø¨ ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª</p>
  </div>

   <div class="card date-card">
    <h2>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©</h2>

    <form [formGroup]="dateForm" class="date-form">
      <div class="form-row">
        <div class="form-group">
          <label for="from">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
          <input type="date" id="from" formControlName="from" class="form-control" />
        </div>

        <div class="form-group">
          <label for="to">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
          <input type="date" id="to" formControlName="to" class="form-control" />
        </div>
      </div>

       <div class="quick-dates">
        <button type="button" class="btn btn-outline" (click)="setLastWeek()">
          Ø¢Ø®Ø± Ø£Ø³Ø¨ÙˆØ¹
        </button>
        <button type="button" class="btn btn-outline" (click)="setLastMonth()">
          Ø¢Ø®Ø± 30 ÙŠÙˆÙ…
        </button>
        <button type="button" class="btn btn-outline" (click)="setCurrentMonth()">
          Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
        </button>
        <button type="button" class="btn btn-outline" (click)="setPreviousMonth()">
          Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚
        </button>
      </div>

       <div class="action-buttons">
        <button type="button" class="btn btn-primary" (click)="generateAnalysis()" [disabled]="loading()">
          <span class="icon">ğŸ“ˆ</span> ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„
        </button>

        <button type="button" class="btn btn-secondary" (click)="generateSummary()" [disabled]="loading()">
          <span class="icon">ğŸ“‹</span> Ù…Ù„Ø®Øµ ØªÙ†ÙÙŠØ°ÙŠ
        </button>

        <button type="button" class="btn btn-warning" (click)="generateLeakage()" [disabled]="loading()">
          <span class="icon">ğŸ”</span> ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ³Ø±Ø¨
        </button>

        @if (hasReport()) {
        <button type="button" class="btn btn-danger" (click)="clearReports()">
          <span class="icon">ğŸ—‘ï¸</span> Ù…Ø³Ø­
        </button>
        }
      </div>
    </form>
  </div>

   @if (loading()) {
  <div class="loading-container">
    <div class="spinner"></div>
    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...</p>
  </div>
  }

   @if (error()) {
  <div class="alert alert-error">
    <span class="icon">âš ï¸</span>
    <div>
      <strong>Ø®Ø·Ø£:</strong>
      <p>{{ error() }}</p>
    </div>
  </div>
  }

   @if (analysisReport() && !loading()) {
  <div class="report-content">
     <div class="card period-card">
      <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØªØ±Ø©</h3>
      <div class="period-stats">
        <div class="stat">
          <span class="label">Ù…Ù†</span>
          <span class="value">{{ analysisReport()!.period.start_date }}</span>
        </div>
        <div class="stat">
          <span class="label">Ø¥Ù„Ù‰</span>
          <span class="value">{{ analysisReport()!.period.end_date }}</span>
        </div>
        <div class="stat">
          <span class="label">Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„</span>
          <span class="value">{{ analysisReport()!.period.operating_days }}</span>
        </div>
        <div class="stat">
          <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</span>
          <span class="value">{{ analysisReport()!.period.total_operations }}</span>
        </div>
      </div>
    </div>

     <div class="card executive-card">
      <h3>Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ</h3>
      <div class="executive-content">
        <div class="health-indicator">
          <span class="label">Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</span>
          <span
            [class]="'health-badge ' + getHealthColorClass(analysisReport()!.executive_summary.current_profit_health)">
            {{ analysisReport()!.executive_summary.current_profit_health }}
          </span>
        </div>

        <div class="summary-section">
          <h4>âœ… Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©</h4>
          <ul>
            @for (strength of analysisReport()!.executive_summary.key_strengths; track strength) {
            <li>{{ strength }}</li>
            }
          </ul>
        </div>

        <div class="summary-section">
          <h4>âš ï¸ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù</h4>
          <ul>
            @for (weakness of analysisReport()!.executive_summary.key_weaknesses; track weakness) {
            <li>{{ weakness }}</li>
            }
          </ul>
        </div>

        <div class="summary-section">
          <h4>ğŸ¯ Ø£Ù‡Ù… 3 Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</h4>
          <ol>
            @for (action of analysisReport()!.executive_summary.top_3_actions; track action) {
            <li>{{ action }}</li>
            }
          </ol>
        </div>

        <div class="potential-increase">
          <strong>Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©:</strong>
          <span class="amount">{{ analysisReport()!.executive_summary.potential_profit_increase }}</span>
        </div>
      </div>
    </div>

     <div class="tabs">
      <button [class.active]="activeTab() === 'composition'" (click)="switchTab('composition')">
        ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø£Ø±Ø¨Ø§Ø­
      </button>
      <button [class.active]="activeTab() === 'per-kg'" (click)="switchTab('per-kg')">
        Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ù„ÙƒÙ„ ÙƒÙŠÙ„Ùˆ
      </button>
      <button [class.active]="activeTab() === 'leakage'" (click)="switchTab('leakage')">
        Ø§Ù„ØªØ³Ø±Ø¨
      </button>
      <button [class.active]="activeTab() === 'stability'" (click)="switchTab('stability')">
        Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø± ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø±
      </button>
      <button [class.active]="activeTab() === 'efficiency'" (click)="switchTab('efficiency')">
        Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„ÙƒÙØ§Ø¡Ø©
      </button>
      <button [class.active]="activeTab() === 'recommendations'" (click)="switchTab('recommendations')">
        Ø§Ù„ØªÙˆØµÙŠØ§Øª
      </button>
    </div>

     <div class="tab-content">
       @if (activeTab() === 'composition') {
      <div class="card">
        <h3>ğŸ“Š ØªØ­Ù„ÙŠÙ„ ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h3>
        <p class="description">{{ analysisReport()!['1_profit_composition_analysis'].description }}</p>

        <div class="total-profit">
          <span class="label">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
          <span class="value">{{ formatNumber(analysisReport()!['1_profit_composition_analysis'].total_net_profit) }}
            Ø¬.Ù…</span>
        </div>

        <div class="components-grid">
          @for (component of profitComponents; track component.key) {
          <div class="component-card">
            <div class="component-header">
              <span class="icon">{{ component.icon }}</span>
              <span class="title">{{ component.label }}</span>
            </div>
            <div class="component-amount">
              {{ formatNumber(getProfitComponent(component.key)?.amount) }} Ø¬.Ù…
            </div>
            <div class="component-percentage">
              {{ formatPercentage(getProfitComponent(component.key)?.percentage) }}
            </div>
            <p class="component-desc">
              {{ getProfitComponent(component.key)?.description }}
            </p>
          </div>
          }
        </div>

        <div class="key-insight">
          <strong>ğŸ’¡ Ø§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:</strong>
          <p>{{ analysisReport()!['1_profit_composition_analysis'].key_insight }}</p>
        </div>
      </div>
      }

       @if (activeTab() === 'per-kg') {
      <div class="card">
        <h3>âš–ï¸ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ù„ÙƒÙ„ ÙƒÙŠÙ„ÙˆØ¬Ø±Ø§Ù…</h3>
        <p class="description">{{ analysisReport()!['2_profit_per_kg_analysis'].description }}</p>

        <div class="metrics-grid">
          <div class="metric-card">
            <span class="label">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ / ÙƒØ¬Ù… Ù…Ø¨Ø§Ø¹</span>
            <span class="value">{{
              formatNumber(analysisReport()!['2_profit_per_kg_analysis'].current_period.net_profit_per_sold_kg) }}
              Ø¬.Ù…</span>
          </div>
          <div class="metric-card">
            <span class="label">Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ / ÙƒØ¬Ù…</span>
            <span class="value">{{
              formatNumber(analysisReport()!['2_profit_per_kg_analysis'].current_period.gross_margin_per_kg) }}
              Ø¬.Ù…</span>
          </div>
          <div class="metric-card">
            <span class="label">Ø®Ø³Ø§Ø¦Ø± / ÙƒØ¬Ù…</span>
            <span class="value negative">{{
              formatNumber(analysisReport()!['2_profit_per_kg_analysis'].current_period.loss_erosion_per_kg) }}
              Ø¬.Ù…</span>
          </div>
          <div class="metric-card">
            <span class="label">ØªÙƒØ§Ù„ÙŠÙ / ÙƒØ¬Ù…</span>
            <span class="value">{{
              formatNumber(analysisReport()!['2_profit_per_kg_analysis'].current_period.cost_burden_per_kg) }}
              Ø¬.Ù…</span>
          </div>
        </div>

        <div class="trend-section">
          <h4>Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h4>
          <div class="trend-card">
            <span class="trend-icon">{{
              getTrendIcon(analysisReport()!['2_profit_per_kg_analysis'].previous_period_comparison.trend) }}</span>
            <div class="trend-details">
              <span class="trend-label">{{
                analysisReport()!['2_profit_per_kg_analysis'].previous_period_comparison.trend }}</span>
              <span class="trend-change">{{
                formatNumber(analysisReport()!['2_profit_per_kg_analysis'].previous_period_comparison.net_profit_per_sold_kg_change)
                }} Ø¬.Ù… ({{
                formatPercentage(analysisReport()!['2_profit_per_kg_analysis'].previous_period_comparison.net_profit_per_sold_kg_change_pct)
                }})</span>
              <p class="trend-explanation">{{
                analysisReport()!['2_profit_per_kg_analysis'].previous_period_comparison.explanation }}</p>
            </div>
          </div>
        </div>

        <div class="key-insight">
          <strong>ğŸ’¡ Ø§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:</strong>
          <p>{{ analysisReport()!['2_profit_per_kg_analysis'].key_insight }}</p>
        </div>
      </div>
      }

       @if (activeTab() === 'leakage') {
      <div class="card">
        <h3>ğŸ” Ø§ÙƒØªØ´Ø§Ù ØªØ³Ø±Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h3>
        <p class="description">{{ analysisReport()!['3_profit_leakage_detection'].description }}</p>

        <div class="leakage-summary">
          <div class="leakage-stat">
            <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ³Ø±Ø¨ Ø§Ù„Ù…Ø­Ø¯Ø¯:</span>
            <span class="value negative">{{
              formatNumber(analysisReport()!['3_profit_leakage_detection'].total_identified_leakage) }} Ø¬.Ù…</span>
          </div>
          <div class="leakage-stat">
            <span class="label">Ù†Ø³Ø¨Ø© Ù…Ù† Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…Ø­ØªÙ…Ù„:</span>
            <span class="value">{{
              formatPercentage(analysisReport()!['3_profit_leakage_detection'].leakage_as_percent_of_potential_profit)
              }}</span>
          </div>
        </div>

        <h4>Ù…ØµØ§Ø¯Ø± Ø§Ù„ØªØ³Ø±Ø¨</h4>
        @for (source of analysisReport()!['3_profit_leakage_detection'].leakage_sources; track source.source) {
        <div class="leakage-source">
          <div class="source-header">
            <span class="source-type">{{ source.source }}</span>
            <span class="source-amount negative">-{{ formatNumber(source.leakage_amount) }} Ø¬.Ù…</span>
          </div>
          <p class="source-explanation">{{ source.explanation }}</p>
          <div class="source-action">
            <strong>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</strong> {{ source.action }}
          </div>

          @if (source.affected_farms && source.affected_farms.length > 0) {
          <div class="affected-entities">
            <h5>Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©:</h5>
            @for (farm of source.affected_farms; track farm.farm_id) {
            <div class="entity-card">
              <span class="entity-name">{{ farm.farm_name }}</span>
              <span class="entity-impact">ØªØ³Ø±Ø¨: {{ formatNumber(farm.total_leakage) }} Ø¬.Ù…</span>
            </div>
            }
          </div>
          }

          @if (source.affected_buyers && source.affected_buyers.length > 0) {
          <div class="affected-entities">
            <h5>Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ† Ø§Ù„Ù…ØªØ£Ø«Ø±ÙŠÙ†:</h5>
            @for (buyer of source.affected_buyers; track buyer.buyer_id) {
            <div class="entity-card">
              <span class="entity-name">{{ buyer.buyer_name }}</span>
              <span class="entity-impact">ØªØ³Ø±Ø¨: {{ formatNumber(buyer.total_leakage) }} Ø¬.Ù…</span>
            </div>
            }
          </div>
          }
        </div>
        }

        @if (analysisReport()!['3_profit_leakage_detection'].quick_wins.length > 0) {
        <div class="quick-wins">
          <h4>ğŸ¯ ÙÙˆØ² Ø³Ø±ÙŠØ¹ (Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ù‡Ù„Ø©)</h4>
          @for (win of analysisReport()!['3_profit_leakage_detection'].quick_wins; track win.action) {
          <div class="quick-win-card">
            <div class="win-header">
              <span class="difficulty" [class]="'difficulty-' + win.difficulty.toLowerCase()">
                {{ win.difficulty }}
              </span>
              <span class="savings">{{ formatNumber(win.estimated_monthly_savings) }} Ø¬.Ù…/Ø´Ù‡Ø±</span>
            </div>
            <p class="win-action">{{ win.action }}</p>
          </div>
          }
        </div>
        }
      </div>
      }

       @if (activeTab() === 'stability') {
      <div class="card">
        <h3>ğŸ“‰ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø±</h3>
        <p class="description">{{ analysisReport()!['4_profit_stability_and_risk'].description }}</p>

        <div class="volatility-section">
          <h4>ØªÙ‚Ù„Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h4>
          <div class="volatility-card">
            <div class="volatility-metric">
              <span class="label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠ:</span>
              <span class="value">{{
                formatNumber(analysisReport()!['4_profit_stability_and_risk'].daily_profit_volatility.mean_daily_profit)
                }} Ø¬.Ù…</span>
            </div>
            <div class="volatility-metric">
              <span class="label">ØªØµÙ†ÙŠÙ Ø§Ù„ØªÙ‚Ù„Ø¨:</span>
              <span
                [class]="'volatility-badge ' + getRiskClass(analysisReport()!['4_profit_stability_and_risk'].daily_profit_volatility.volatility_rating)">
                {{ analysisReport()!['4_profit_stability_and_risk'].daily_profit_volatility.volatility_rating }}
              </span>
            </div>
            <p class="volatility-interpretation">
              {{ analysisReport()!['4_profit_stability_and_risk'].daily_profit_volatility.interpretation }}
            </p>
          </div>
        </div>

        <div class="risk-section">
          <h4>Ù…Ø®Ø§Ø·Ø± Ø§Ù„ØªØ±ÙƒÙŠØ²</h4>
          <div class="risks-grid">
            <div class="risk-card">
              <h5>ØªØ±ÙƒÙŠØ² Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</h5>
              <span
                [class]="'risk-badge ' + getRiskClass(analysisReport()!['4_profit_stability_and_risk'].dependency_risks.vehicle_concentration.risk_level)">
                {{ analysisReport()!['4_profit_stability_and_risk'].dependency_risks.vehicle_concentration.risk_level }}
              </span>
              <p>{{ analysisReport()!['4_profit_stability_and_risk'].dependency_risks.vehicle_concentration.explanation
                }}</p>
            </div>

            <div class="risk-card">
              <h5>ØªØ±ÙƒÙŠØ² Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ†</h5>
              <span
                [class]="'risk-badge ' + getRiskClass(analysisReport()!['4_profit_stability_and_risk'].dependency_risks.buyer_concentration.risk_level)">
                {{ analysisReport()!['4_profit_stability_and_risk'].dependency_risks.buyer_concentration.risk_level }}
              </span>
              <p>{{ analysisReport()!['4_profit_stability_and_risk'].dependency_risks.buyer_concentration.explanation }}
              </p>
            </div>

            <div class="risk-card">
              <h5>ØªØ±ÙƒÙŠØ² Ø§Ù„Ù…Ø²Ø§Ø±Ø¹</h5>
              <span
                [class]="'risk-badge ' + getRiskClass(analysisReport()!['4_profit_stability_and_risk'].dependency_risks.farm_concentration.risk_level)">
                {{ analysisReport()!['4_profit_stability_and_risk'].dependency_risks.farm_concentration.risk_level }}
              </span>
            </div>
          </div>
        </div>
      </div>
      }

       @if (activeTab() === 'efficiency') {
      <div class="card">
        <h3>âš¡ Ù…Ø¤Ø´Ø±Ø§Øª ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h3>
        <p class="description">{{ analysisReport()!['5_profit_efficiency_indicators'].description }}</p>

        <div class="efficiency-metrics">
          <div class="efficiency-card">
            <h4>Ø§Ù„Ø±Ø¨Ø­ Ù„ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ©</h4>
            <div class="metric-value">{{
              formatNumber(analysisReport()!['5_profit_efficiency_indicators'].profit_per_operation.average) }} Ø¬.Ù…
            </div>
            @if (analysisReport()!['5_profit_efficiency_indicators'].profit_per_operation.best_operation) {
            <p class="metric-detail">
              Ø£ÙØ¶Ù„: {{
              formatNumber(analysisReport()!['5_profit_efficiency_indicators'].profit_per_operation.best_operation!.profit)
              }} Ø¬.Ù…
              ({{ analysisReport()!['5_profit_efficiency_indicators'].profit_per_operation.best_operation!.date }})
            </p>
            }
          </div>

          <div class="efficiency-card">
            <h4>Ø§Ù„Ø±Ø¨Ø­ Ù„ÙƒÙ„ Ù…Ø±ÙƒØ¨Ø©/ÙŠÙˆÙ…</h4>
            <div class="metric-value">{{
              formatNumber(analysisReport()!['5_profit_efficiency_indicators'].profit_per_vehicle_day.average) }} Ø¬.Ù…
            </div>
            @if (analysisReport()!['5_profit_efficiency_indicators'].profit_per_vehicle_day.top_vehicle) {
            <p class="metric-detail">
              Ø£ÙØ¶Ù„: {{
              analysisReport()!['5_profit_efficiency_indicators'].profit_per_vehicle_day.top_vehicle!.vehicle_name }}
              ({{
              formatNumber(analysisReport()!['5_profit_efficiency_indicators'].profit_per_vehicle_day.top_vehicle!.avg_profit_per_day)
              }} Ø¬.Ù…)
            </p>
            }
          </div>

          <div class="efficiency-card">
            <h4>Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ</h4>
            <div class="metric-value">{{
              formatPercentage(analysisReport()!['5_profit_efficiency_indicators'].return_on_costs.roi_percentage) }}
            </div>
            <p class="metric-detail">{{ analysisReport()!['5_profit_efficiency_indicators'].return_on_costs.explanation
              }}</p>
          </div>
        </div>
      </div>
      }

       @if (activeTab() === 'recommendations') {
      <div class="card">
        <h3>ğŸ¯ Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ†ÙÙŠØ°</h3>
        <p class="description">{{ analysisReport()!['6_actionable_profit_recommendations'].description }}</p>

        <div class="recommendations-summary">
          <div class="summary-card">
            <span class="label">Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©:</span>
            <span class="value">{{
              formatNumber(analysisReport()!['6_actionable_profit_recommendations'].summary.total_potential_monthly_profit_increase)
              }} Ø¬.Ù…</span>
          </div>
          <div class="summary-card">
            <span class="label">Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©:</span>
            <span class="value">{{
              formatNumber(analysisReport()!['6_actionable_profit_recommendations'].summary.total_potential_annual_profit_increase)
              }} Ø¬.Ù…</span>
          </div>
          <div class="summary-card">
            <span class="label">ÙÙˆØ² Ø³Ø±ÙŠØ¹ (< 30 ÙŠÙˆÙ…):</span>
                <span class="value">{{
                  analysisReport()!['6_actionable_profit_recommendations'].summary.quick_wins_under_30_days }}</span>
          </div>
        </div>

        <div class="recommendations-list">
          @for (rec of analysisReport()!['6_actionable_profit_recommendations'].recommendations; track rec.id) {
          <div class="recommendation-card">
            <div class="rec-header">
              <span [class]="'rec-priority ' + getPriorityClass(rec.priority)">
                {{ rec.priority }}
              </span>
              <span class="rec-category">{{ rec.category }}</span>
              <span class="rec-impact">+{{ formatNumber(rec.profit_impact_monthly) }} Ø¬.Ù…/Ø´Ù‡Ø±</span>
            </div>

            <div class="rec-body">
              <div class="rec-problem">
                <strong>Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong> {{ rec.problem }}
              </div>
              <div class="rec-action">
                <strong>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡:</strong> {{ rec.action }}
              </div>
              <div class="rec-result">
                <strong>Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:</strong> {{ rec.expected_result }}
              </div>
              <div class="rec-difficulty">
                <strong>Ø§Ù„ØµØ¹ÙˆØ¨Ø©:</strong>
                <span [class]="'difficulty-badge difficulty-' + rec.implementation_difficulty.toLowerCase()">
                  {{ rec.implementation_difficulty }}
                </span>
              </div>
            </div>
          </div>
          }
        </div>
      </div>
      }
    </div>
  </div>
  }

   @if (summaryReport() && !loading()) {
  <div class="report-content">
    <div class="card">
      <h3>ğŸ“‹ Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ</h3>

      <div class="summary-stats">
        <div class="stat-card">
          <span class="label">ØµØ­Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</span>
          <span class="value">{{ formatNumber(summaryReport()!.profit_health) }} Ø¬.Ù…</span>
        </div>
        <div class="stat-card">
          <span class="label">Ø§Ù„Ø±Ø¨Ø­ / ÙƒØ¬Ù…</span>
          <span class="value">{{ formatNumber(summaryReport()!.profit_per_kg) }} Ø¬.Ù…</span>
        </div>
        <div class="stat-card">
          <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ³Ø±Ø¨</span>
          <span class="value negative">{{ formatNumber(summaryReport()!.total_leakage) }} Ø¬.Ù…</span>
        </div>
      </div>

      <div class="executive-summary">
        <h4>Ø§Ù„Ù…Ù„Ø®Øµ</h4>
        <div class="health-indicator">
          <span
            [class]="'health-badge ' + getHealthColorClass(summaryReport()!.executive_summary.current_profit_health)">
            {{ summaryReport()!.executive_summary.current_profit_health }}
          </span>
        </div>

        <div class="summary-lists">
          <div>
            <h5>âœ… Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©</h5>
            <ul>
              @for (strength of summaryReport()!.executive_summary.key_strengths; track strength) {
              <li>{{ strength }}</li>
              }
            </ul>
          </div>
          <div>
            <h5>âš ï¸ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù</h5>
            <ul>
              @for (weakness of summaryReport()!.executive_summary.key_weaknesses; track weakness) {
              <li>{{ weakness }}</li>
              }
            </ul>
          </div>
        </div>

        <div class="potential-increase">
          <strong>Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©:</strong>
          <span class="amount">{{ summaryReport()!.executive_summary.potential_profit_increase }}</span>
        </div>
      </div>

      <div class="top-recommendations">
        <h4>Ø£Ù‡Ù… Ø§Ù„ØªÙˆØµÙŠØ§Øª</h4>
        @for (rec of summaryReport()!.top_recommendations; track rec.id) {
        <div class="recommendation-summary">
          <span [class]="'priority-badge ' + getPriorityClass(rec.priority)">{{ rec.priority }}</span>
          <span class="rec-action">{{ rec.action }}</span>
          <span class="rec-impact">+{{ formatNumber(rec.profit_impact_monthly) }} Ø¬.Ù…</span>
        </div>
        }
      </div>
    </div>
  </div>
  }

   @if (leakageReport() && !loading()) {
  <div class="report-content">
    <div class="card">
      <h3>ğŸ” ØªØ­Ù„ÙŠÙ„ ØªØ³Ø±Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h3>

      <div class="leakage-overview">
        <div class="leakage-total">
          <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ³Ø±Ø¨ Ø§Ù„Ù…Ø­Ø¯Ø¯:</span>
          <span class="value negative">{{ formatNumber(leakageReport()!.leakage_analysis.total_identified_leakage) }}
            Ø¬.Ù…</span>
        </div>
        <div class="leakage-percentage">
          <span class="label">Ù†Ø³Ø¨Ø© Ù…Ù† Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…Ø­ØªÙ…Ù„:</span>
          <span class="value">{{
            formatPercentage(leakageReport()!.leakage_analysis.leakage_as_percent_of_potential_profit) }}</span>
        </div>
      </div>

      <h4>Ù…ØµØ§Ø¯Ø± Ø§Ù„ØªØ³Ø±Ø¨</h4>
      @for (source of leakageReport()!.leakage_analysis.leakage_sources; track source.source) {
      <div class="leakage-source">
        <div class="source-header">
          <span class="source-type">{{ source.source }}</span>
          <span class="source-amount negative">-{{ formatNumber(source.leakage_amount) }} Ø¬.Ù…</span>
        </div>
        <p class="source-explanation">{{ source.explanation }}</p>
        <div class="source-action">
          <strong>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡:</strong> {{ source.action }}
        </div>
      </div>
      }

      @if (leakageReport()!.leakage_analysis.quick_wins.length > 0) {
      <div class="quick-wins">
        <h4>ğŸ¯ ÙÙˆØ² Ø³Ø±ÙŠØ¹</h4>
        @for (win of leakageReport()!.leakage_analysis.quick_wins; track win.action) {
        <div class="quick-win-card">
          <div class="win-header">
            <span [class]="'difficulty-badge difficulty-' + win.difficulty.toLowerCase()">{{ win.difficulty }}</span>
            <span class="savings">{{ formatNumber(win.estimated_monthly_savings) }} Ø¬.Ù…/Ø´Ù‡Ø±</span>
          </div>
          <p class="win-action">{{ win.action }}</p>
        </div>
        }
      </div>
      }
    </div>
  </div>
  }

   @if (hasReport() && !loading()) {
  <div class="export-section">
    <button class="btn btn-outline" (click)="exportToJSON()">
      <span class="icon">ğŸ’¾</span> ØªØµØ¯ÙŠØ± JSON
    </button>
  </div>
  }
</div>   -->
<div class="profit-report-container">
  <!-- ========================================== -->
  <!-- UNIFIED HEADER & DATE RANGE SELECTOR -->
  <!-- ========================================== -->
  <mat-card class="main-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>assessment</mat-icon>
        ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
      </mat-card-title>
      <mat-card-subtitle>
        ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„ØªØ³Ø±Ø¨ ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="dateForm">
        <div class="date-range-form">
          <!-- Date Fields -->
          <div class="date-fields">
            <mat-form-field appearance="outline" class="form-group">
              <mat-label>Ù…Ù† ØªØ§Ø±ÙŠØ®</mat-label>
              <input matInput [matDatepicker]="fromPicker" formControlName="from" required>
              <mat-datepicker-toggle matSuffix [for]="fromPicker"></mat-datepicker-toggle>
              <mat-datepicker #fromPicker></mat-datepicker>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-group">
              <mat-label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</mat-label>
              <input matInput [matDatepicker]="toPicker" formControlName="to" required>
              <mat-datepicker-toggle matSuffix [for]="toPicker"></mat-datepicker-toggle>
              <mat-datepicker #toPicker></mat-datepicker>
            </mat-form-field>
          </div>

          <!-- Quick Date Buttons -->
          <div class="quick-dates">
            <button mat-stroked-button type="button" (click)="setLastWeek()" class="quick-btn">
              <mat-icon>date_range</mat-icon>
              Ø¢Ø®Ø± Ø£Ø³Ø¨ÙˆØ¹
            </button>
            <button mat-stroked-button type="button" (click)="setLastMonth()" class="quick-btn">
              <mat-icon>calendar_month</mat-icon>
              Ø¢Ø®Ø± 30 ÙŠÙˆÙ…
            </button>
            <button mat-stroked-button type="button" (click)="setCurrentMonth()" class="quick-btn">
              <mat-icon>calendar_today</mat-icon>
              Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
            </button>
            <button mat-stroked-button type="button" (click)="setPreviousMonth()" class="quick-btn">
              <mat-icon>history</mat-icon>
              Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚
            </button>
          </div>

          <!-- Report Type Buttons -->
          <div class="report-type-buttons">
            <button mat-raised-button color="primary" type="button" (click)="generateAnalysis()" [disabled]="loading()"
              class="report-type-btn">
              <mat-icon>analytics</mat-icon>
              ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„
            </button>

            <button mat-raised-button color="accent" type="button" (click)="generateSummary()" [disabled]="loading()"
              class="report-type-btn">
              <mat-icon>summarize</mat-icon>
              Ù…Ù„Ø®Øµ ØªÙ†ÙÙŠØ°ÙŠ
            </button>

            <button mat-raised-button color="warn" type="button" (click)="generateLeakage()" [disabled]="loading()"
              class="report-type-btn">
              <mat-icon>troubleshoot</mat-icon>
              ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ³Ø±Ø¨
            </button>

            <button mat-raised-button type="button" (click)="loadPartnerDistribution()" [disabled]="loading()"
              class="report-type-btn partners-btn">
              <mat-icon>groups</mat-icon>
              ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­
            </button>
          </div>

          <!-- Action Buttons -->
          @if (hasReport()) {
          <div class="action-buttons">

            <button mat-stroked-button type="button" (click)="exportToExcel()" class="action-btn" *ngIf="reportType()=='partners'">
              <mat-icon>file_download</mat-icon>
              ØªØµØ¯ÙŠØ± Excel
            </button>

            <button mat-stroked-button type="button" (click)="printReport()" class="action-btn">
              <mat-icon>print</mat-icon>
              Ø·Ø¨Ø§Ø¹Ø©
            </button>



            <button mat-stroked-button color="warn" type="button" (click)="clearReports()" class="action-btn">
              <mat-icon>clear</mat-icon>
              Ù…Ø³Ø­
            </button>
          </div>
          }
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- ========================================== -->
  <!-- LOADING STATE -->
  <!-- ========================================== -->
  @if (loading()) {
  <div class="loading-container">
    <mat-spinner></mat-spinner>
    <p class="loading-text">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...</p>
    <p class="loading-subtext">Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ù‡Ø°Ø§ Ø¨Ø¶Ø¹ Ø«ÙˆØ§Ù†Ù</p>
  </div>
  }

  <!-- ========================================== -->
  <!-- ERROR STATE -->
  <!-- ========================================== -->
  @if (error()) {
  <mat-card class="error-card">
    <mat-card-content class="error-content">
      <mat-icon class="error-icon">error</mat-icon>
      <div>
        <h4>Ø®Ø·Ø£</h4>
        <p>{{ error() }}</p>
      </div>
    </mat-card-content>
  </mat-card>
  }

  <!-- ========================================== -->
  <!-- PROFIT ANALYSIS REPORT (COMPREHENSIVE) -->
  <!-- ========================================== -->
  @if (analysisReport() && !loading()) {
  <div class="report-content" id="report-content">

    <!-- Period Info Banner -->
    <div class="period-info-banner">
      <div class="info-item">
        <mat-icon>date_range</mat-icon>
        <div>
          <span class="label">Ø§Ù„ÙØªØ±Ø©:</span>
          <span class="value">{{ formatDateTime(analysisReport()!.period.start_date) }} - {{
            formatDateTime(analysisReport()!.period.end_date) }}</span>
        </div>
      </div>
      <div class="info-item">
        <mat-icon>event</mat-icon>
        <div>
          <span class="label">Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„:</span>
          <span class="value">{{ formatNumber(analysisReport()!.period.operating_days, 0) }}</span>
        </div>
      </div>
      <div class="info-item">
        <mat-icon>local_shipping</mat-icon>
        <div>
          <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª:</span>
          <span class="value">{{ formatNumber(analysisReport()!.period.total_operations, 0) }}</span>
        </div>
      </div>
    </div>

    <!-- Executive Summary Card -->
    <mat-card class="summary-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>summarize</mat-icon>
          Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="health-indicator">
          <span class="label">Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</span>
          <span
            [class]="'health-badge ' + getHealthColorClass(analysisReport()!.executive_summary.current_profit_health)">
            {{ analysisReport()!.executive_summary.current_profit_health }}
          </span>
        </div>

        <div class="summary-sections">
          <div class="summary-section success">
            <h4><mat-icon>check_circle</mat-icon> Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©</h4>
            <ul>
              @for (strength of analysisReport()!.executive_summary.key_strengths; track strength) {
              <li>{{ strength }}</li>
              }
            </ul>
          </div>

          <div class="summary-section warning">
            <h4><mat-icon>warning</mat-icon> Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù</h4>
            <ul>
              @for (weakness of analysisReport()!.executive_summary.key_weaknesses; track weakness) {
              <li>{{ weakness }}</li>
              }
            </ul>
          </div>

          <div class="summary-section info">
            <h4><mat-icon>track_changes</mat-icon> Ø£Ù‡Ù… 3 Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</h4>
            <ol>
              @for (action of analysisReport()!.executive_summary.top_3_actions; track action) {
              <li>{{ action }}</li>
              }
            </ol>
          </div>
        </div>

        <div class="potential-increase">
          <strong>Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø© ÙÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</strong>
          <span class="amount">{{ analysisReport()!.executive_summary.potential_profit_increase }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Tabs Navigation -->
    <mat-card class="tabs-card">
      <mat-tab-group [selectedIndex]="activeTabIndex()" (selectedIndexChange)="onTabChange($event)">

        <!-- Tab 1: Profit Composition -->
        <mat-tab label="ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø£Ø±Ø¨Ø§Ø­">
          <div class="tab-content">
            <p class="description">{{ analysisReport()!['1_profit_composition_analysis'].description }}</p>

            <div class="total-profit-banner">
              <span class="label">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
              <span class="value">{{ formatCurrency(analysisReport()!['1_profit_composition_analysis'].total_net_profit)
                }} Ø¬.Ù…</span>
            </div>

            <div class="components-grid">
              @for (component of profitComponents; track component.key) {
              <div class="component-card">
                <div class="component-header">
                  <span class="icon">{{ component.icon }}</span>
                  <span class="title">{{ component.label }}</span>
                </div>
                <div class="component-amount">
                  {{ formatCurrency(getProfitComponent(component.key)?.amount) }} Ø¬.Ù…
                </div>
                <div class="component-percentage">
                  {{ formatPercentage(getProfitComponent(component.key)?.percentage) }}
                </div>
                <p class="component-desc">
                  {{ getProfitComponent(component.key)?.description }}
                </p>
              </div>
              }
            </div>

            <div class="key-insight">
              <strong>ğŸ’¡ Ø§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:</strong>
              <p>{{ analysisReport()!['1_profit_composition_analysis'].key_insight }}</p>
            </div>
          </div>
        </mat-tab>

        <!-- Tab 2: Profit Per KG -->
        <mat-tab label="Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ù„ÙƒÙ„ ÙƒÙŠÙ„Ùˆ">
          <div class="tab-content">
            <p class="description">{{ analysisReport()!['2_profit_per_kg_analysis'].description }}</p>

            <div class="metrics-grid">
              <mat-card class="metric-card-detail">
                <mat-card-content>
                  <span class="metric-label">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ / ÙƒØ¬Ù… Ù…Ø¨Ø§Ø¹</span>
                  <span class="metric-value">{{
                    formatCurrency(analysisReport()!['2_profit_per_kg_analysis'].current_period.net_profit_per_sold_kg)
                    }} Ø¬.Ù…</span>
                </mat-card-content>
              </mat-card>

              <mat-card class="metric-card-detail">
                <mat-card-content>
                  <span class="metric-label">Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ / ÙƒØ¬Ù…</span>
                  <span class="metric-value">{{
                    formatCurrency(analysisReport()!['2_profit_per_kg_analysis'].current_period.gross_margin_per_kg) }}
                    Ø¬.Ù…</span>
                </mat-card-content>
              </mat-card>

              <mat-card class="metric-card-detail negative">
                <mat-card-content>
                  <span class="metric-label">Ø®Ø³Ø§Ø¦Ø± / ÙƒØ¬Ù…</span>
                  <span class="metric-value">{{
                    formatCurrency(analysisReport()!['2_profit_per_kg_analysis'].current_period.loss_erosion_per_kg) }}
                    Ø¬.Ù…</span>
                </mat-card-content>
              </mat-card>

              <mat-card class="metric-card-detail">
                <mat-card-content>
                  <span class="metric-label">ØªÙƒØ§Ù„ÙŠÙ / ÙƒØ¬Ù…</span>
                  <span class="metric-value">{{
                    formatCurrency(analysisReport()!['2_profit_per_kg_analysis'].current_period.cost_burden_per_kg) }}
                    Ø¬.Ù…</span>
                </mat-card-content>
              </mat-card>
            </div>

            <mat-card class="trend-card">
              <mat-card-header>
                <mat-card-title>Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="trend-indicator">
                  <span class="trend-icon">{{
                    getTrendIcon(analysisReport()!['2_profit_per_kg_analysis'].previous_period_comparison.trend)
                    }}</span>
                  <div class="trend-details">
                    <span class="trend-label">{{
                      analysisReport()!['2_profit_per_kg_analysis'].previous_period_comparison.trend }}</span>
                    <span class="trend-change">
                      {{
                      formatCurrency(analysisReport()!['2_profit_per_kg_analysis'].previous_period_comparison.net_profit_per_sold_kg_change)
                      }} Ø¬.Ù…
                      ({{
                      formatPercentage(analysisReport()!['2_profit_per_kg_analysis'].previous_period_comparison.net_profit_per_sold_kg_change_pct)
                      }})
                    </span>
                    <p class="trend-explanation">{{
                      analysisReport()!['2_profit_per_kg_analysis'].previous_period_comparison.explanation }}</p>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>

            <div class="key-insight">
              <strong>ğŸ’¡ Ø§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:</strong>
              <p>{{ analysisReport()!['2_profit_per_kg_analysis'].key_insight }}</p>
            </div>
          </div>
        </mat-tab>

        <!-- Tab 3: Leakage Analysis -->
        <mat-tab label="Ø§Ù„ØªØ³Ø±Ø¨">
          <div class="tab-content">
            <p class="description">{{ analysisReport()!['3_profit_leakage_detection'].description }}</p>

            <div class="leakage-summary-grid">
              <mat-card class="leakage-stat-card negative">
                <mat-card-content>
                  <span class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ³Ø±Ø¨ Ø§Ù„Ù…Ø­Ø¯Ø¯:</span>
                  <span class="stat-value">{{
                    formatCurrency(analysisReport()!['3_profit_leakage_detection'].total_identified_leakage) }}
                    Ø¬.Ù…</span>
                </mat-card-content>
              </mat-card>

              <mat-card class="leakage-stat-card">
                <mat-card-content>
                  <span class="stat-label">Ù†Ø³Ø¨Ø© Ù…Ù† Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…Ø­ØªÙ…Ù„:</span>
                  <span class="stat-value">{{
                    formatPercentage(analysisReport()!['3_profit_leakage_detection'].leakage_as_percent_of_potential_profit)
                    }}</span>
                </mat-card-content>
              </mat-card>
            </div>

            <h4 class="section-title"><mat-icon>list</mat-icon> Ù…ØµØ§Ø¯Ø± Ø§Ù„ØªØ³Ø±Ø¨</h4>
            @for (source of analysisReport()!['3_profit_leakage_detection'].leakage_sources; track source.source) {
            <mat-card class="leakage-source-card">
              <mat-card-header>
                <mat-card-title>
                  <span class="source-type">{{ source.source }}</span>
                  <span class="source-amount negative">-{{ formatCurrency(source.leakage_amount) }} Ø¬.Ù…</span>
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <p class="source-explanation">{{ source.explanation }}</p>
                <div class="source-action">
                  <mat-icon>lightbulb</mat-icon>
                  <strong>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</strong> {{ source.action }}
                </div>

                @if (source.affected_farms && source.affected_farms.length > 0) {
                <div class="affected-entities">
                  <h5><mat-icon>agriculture</mat-icon> Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„Ù…ØªØ£Ø«Ø±Ø©:</h5>
                  <div class="entities-grid">
                    @for (farm of source.affected_farms; track farm.farm_id) {
                    <div class="entity-chip">
                      <span class="entity-name">{{ farm.farm_name }}</span>
                      <span class="entity-impact">{{ formatCurrency(farm.total_leakage) }} Ø¬.Ù…</span>
                    </div>
                    }
                  </div>
                </div>
                }

                @if (source.affected_buyers && source.affected_buyers.length > 0) {
                <div class="affected-entities">
                  <h5><mat-icon>store</mat-icon> Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ† Ø§Ù„Ù…ØªØ£Ø«Ø±ÙŠÙ†:</h5>
                  <div class="entities-grid">
                    @for (buyer of source.affected_buyers; track buyer.buyer_id) {
                    <div class="entity-chip">
                      <span class="entity-name">{{ buyer.buyer_name }}</span>
                      <span class="entity-impact">{{ formatCurrency(buyer.total_leakage) }} Ø¬.Ù…</span>
                    </div>
                    }
                  </div>
                </div>
                }
              </mat-card-content>
            </mat-card>
            }

            @if (analysisReport()!['3_profit_leakage_detection'].quick_wins.length > 0) {
            <mat-card class="quick-wins-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>flash_on</mat-icon>
                  ÙÙˆØ² Ø³Ø±ÙŠØ¹ (Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ù‡Ù„Ø©)
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                @for (win of analysisReport()!['3_profit_leakage_detection'].quick_wins; track win.action) {
                <div class="quick-win-item">
                  <div class="win-header">
                    <span [class]="'difficulty-badge difficulty-' + win.difficulty.toLowerCase()">{{ win.difficulty
                      }}</span>
                    <span class="win-savings">{{ formatCurrency(win.estimated_monthly_savings) }} Ø¬.Ù…/Ø´Ù‡Ø±</span>
                  </div>
                  <p class="win-action">{{ win.action }}</p>
                </div>
                }
              </mat-card-content>
            </mat-card>
            }
          </div>
        </mat-tab>

        <!-- Tab 4: Stability & Risk -->
        <mat-tab label="Ø§Ù„Ø§Ø³ØªÙ‚Ø±Ø§Ø± ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø±">
          <div class="tab-content">
            <p class="description">{{ analysisReport()!['4_profit_stability_and_risk'].description }}</p>

            <mat-card class="volatility-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>show_chart</mat-icon>
                  ØªÙ‚Ù„Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="volatility-metrics">
                  <div class="volatility-metric">
                    <span class="v-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠ:</span>
                    <span class="v-value">{{
                      formatCurrency(analysisReport()!['4_profit_stability_and_risk'].daily_profit_volatility.mean_daily_profit)
                      }} Ø¬.Ù…</span>
                  </div>
                  <div class="volatility-metric">
                    <span class="v-label">ØªØµÙ†ÙŠÙ Ø§Ù„ØªÙ‚Ù„Ø¨:</span>
                    <span
                      [class]="'volatility-badge ' + getRiskClass(analysisReport()!['4_profit_stability_and_risk'].daily_profit_volatility.volatility_rating)">
                      {{ analysisReport()!['4_profit_stability_and_risk'].daily_profit_volatility.volatility_rating }}
                    </span>
                  </div>
                </div>
                <p class="volatility-interpretation">{{
                  analysisReport()!['4_profit_stability_and_risk'].daily_profit_volatility.interpretation }}</p>
              </mat-card-content>
            </mat-card>

            <h4 class="section-title"><mat-icon>warning</mat-icon> Ù…Ø®Ø§Ø·Ø± Ø§Ù„ØªØ±ÙƒÙŠØ²</h4>
            <div class="risks-grid">
              <mat-card class="risk-card">
                <mat-card-header>
                  <mat-card-title>
                    <mat-icon>local_shipping</mat-icon>
                    ØªØ±ÙƒÙŠØ² Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª
                  </mat-card-title>
                </mat-card-header>
                <mat-card-content>
                  <span
                    [class]="'risk-badge ' + getRiskClass(analysisReport()!['4_profit_stability_and_risk'].dependency_risks.vehicle_concentration.risk_level)">
                    {{
                    analysisReport()!['4_profit_stability_and_risk'].dependency_risks.vehicle_concentration.risk_level
                    }}
                  </span>
                  <p>{{
                    analysisReport()!['4_profit_stability_and_risk'].dependency_risks.vehicle_concentration.explanation
                    }}</p>
                </mat-card-content>
              </mat-card>

              <mat-card class="risk-card">
                <mat-card-header>
                  <mat-card-title>
                    <mat-icon>store</mat-icon>
                    ØªØ±ÙƒÙŠØ² Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ†
                  </mat-card-title>
                </mat-card-header>
                <mat-card-content>
                  <span
                    [class]="'risk-badge ' + getRiskClass(analysisReport()!['4_profit_stability_and_risk'].dependency_risks.buyer_concentration.risk_level)">
                    {{ analysisReport()!['4_profit_stability_and_risk'].dependency_risks.buyer_concentration.risk_level
                    }}
                  </span>
                  <p>{{
                    analysisReport()!['4_profit_stability_and_risk'].dependency_risks.buyer_concentration.explanation }}
                  </p>
                </mat-card-content>
              </mat-card>

              <mat-card class="risk-card">
                <mat-card-header>
                  <mat-card-title>
                    <mat-icon>agriculture</mat-icon>
                    ØªØ±ÙƒÙŠØ² Ø§Ù„Ù…Ø²Ø§Ø±Ø¹
                  </mat-card-title>
                </mat-card-header>
                <mat-card-content>
                  <span
                    [class]="'risk-badge ' + getRiskClass(analysisReport()!['4_profit_stability_and_risk'].dependency_risks.farm_concentration.risk_level)">
                    {{ analysisReport()!['4_profit_stability_and_risk'].dependency_risks.farm_concentration.risk_level
                    }}
                  </span>
                  <p>{{ analysisReport()!['4_profit_stability_and_risk'].dependency_risks.farm_concentration.explanation
                    }}</p>
                </mat-card-content>
              </mat-card>
            </div>
          </div>
        </mat-tab>

        <!-- Tab 5: Efficiency Indicators -->
        <mat-tab label="Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„ÙƒÙØ§Ø¡Ø©">
          <div class="tab-content">
            <p class="description">{{ analysisReport()!['5_profit_efficiency_indicators'].description }}</p>

            <div class="efficiency-metrics-grid">
              <mat-card class="efficiency-metric-card">
                <mat-card-header>
                  <mat-card-title>
                    <mat-icon>receipt</mat-icon>
                    Ø§Ù„Ø±Ø¨Ø­ Ù„ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ©
                  </mat-card-title>
                </mat-card-header>
                <mat-card-content>
                  <div class="efficiency-value">{{
                    formatCurrency(analysisReport()!['5_profit_efficiency_indicators'].profit_per_operation.average) }}
                    Ø¬.Ù…</div>
                  @if (analysisReport()!['5_profit_efficiency_indicators'].profit_per_operation.best_operation) {
                  <p class="efficiency-detail">
                    <strong>Ø£ÙØ¶Ù„ Ø¹Ù…Ù„ÙŠØ©:</strong>
                    {{
                    formatCurrency(analysisReport()!['5_profit_efficiency_indicators'].profit_per_operation.best_operation!.profit)
                    }} Ø¬.Ù…
                    ({{
                    formatDateTime(analysisReport()!['5_profit_efficiency_indicators'].profit_per_operation.best_operation!.date)
                    }})
                  </p>
                  }
                </mat-card-content>
              </mat-card>

              <mat-card class="efficiency-metric-card">
                <mat-card-header>
                  <mat-card-title>
                    <mat-icon>local_shipping</mat-icon>
                    Ø§Ù„Ø±Ø¨Ø­ Ù„ÙƒÙ„ Ù…Ø±ÙƒØ¨Ø©/ÙŠÙˆÙ…
                  </mat-card-title>
                </mat-card-header>
                <mat-card-content>
                  <div class="efficiency-value">{{
                    formatCurrency(analysisReport()!['5_profit_efficiency_indicators'].profit_per_vehicle_day.average)
                    }} Ø¬.Ù…</div>
                  @if (analysisReport()!['5_profit_efficiency_indicators'].profit_per_vehicle_day.top_vehicle) {
                  <p class="efficiency-detail">
                    <strong>Ø£ÙØ¶Ù„ Ù…Ø±ÙƒØ¨Ø©:</strong>
                    {{
                    analysisReport()!['5_profit_efficiency_indicators'].profit_per_vehicle_day.top_vehicle!.vehicle_name
                    }}
                    ({{
                    formatCurrency(analysisReport()!['5_profit_efficiency_indicators'].profit_per_vehicle_day.top_vehicle!.avg_profit_per_day)
                    }} Ø¬.Ù…)
                  </p>
                  }
                </mat-card-content>
              </mat-card>

              <mat-card class="efficiency-metric-card">
                <mat-card-header>
                  <mat-card-title>
                    <mat-icon>trending_up</mat-icon>
                    Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ
                  </mat-card-title>
                </mat-card-header>
                <mat-card-content>
                  <div class="efficiency-value">{{
                    formatPercentage(analysisReport()!['5_profit_efficiency_indicators'].return_on_costs.roi_percentage)
                    }}</div>
                  <p class="efficiency-detail">{{
                    analysisReport()!['5_profit_efficiency_indicators'].return_on_costs.explanation }}</p>
                </mat-card-content>
              </mat-card>
            </div>
          </div>
        </mat-tab>

        <!-- Tab 6: Recommendations -->
        <mat-tab label="Ø§Ù„ØªÙˆØµÙŠØ§Øª">
          <div class="tab-content">
            <p class="description">{{ analysisReport()!['6_actionable_profit_recommendations'].description }}</p>

            <div class="recommendations-summary-grid">
              <mat-card class="rec-summary-card">
                <mat-card-content>
                  <span class="rec-sum-label">Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©:</span>
                  <span class="rec-sum-value">{{
                    formatCurrency(analysisReport()!['6_actionable_profit_recommendations'].summary.total_potential_monthly_profit_increase)
                    }} Ø¬.Ù…</span>
                </mat-card-content>
              </mat-card>

              <mat-card class="rec-summary-card">
                <mat-card-content>
                  <span class="rec-sum-label">Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ù†ÙˆÙŠØ© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©:</span>
                  <span class="rec-sum-value">{{
                    formatCurrency(analysisReport()!['6_actionable_profit_recommendations'].summary.total_potential_annual_profit_increase)
                    }} Ø¬.Ù…</span>
                </mat-card-content>
              </mat-card>

              <mat-card class="rec-summary-card">
                <mat-card-content>
                  <span class="rec-sum-label">ÙÙˆØ² Ø³Ø±ÙŠØ¹ (< Ù£Ù  ÙŠÙˆÙ…):</span>
                      <span class="rec-sum-value">{{
                        formatNumber(analysisReport()!['6_actionable_profit_recommendations'].summary.quick_wins_under_30_days,
                        0) }}</span>
                </mat-card-content>
              </mat-card>
            </div>

            <div class="recommendations-list">
              @for (rec of analysisReport()!['6_actionable_profit_recommendations'].recommendations; track rec.id) {
              <mat-card class="recommendation-detail-card">
                <mat-card-header>
                  <div class="rec-detail-header">
                    <span [class]="'priority-badge ' + getPriorityClass(rec.priority)">{{ rec.priority }}</span>
                    <span class="rec-category">{{ rec.category }}</span>
                    <span class="rec-impact-badge">+{{ formatCurrency(rec.profit_impact_monthly) }} Ø¬.Ù…/Ø´Ù‡Ø±</span>
                  </div>
                </mat-card-header>
                <mat-card-content>
                  <div class="rec-problem-section">
                    <strong><mat-icon>error_outline</mat-icon> Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:</strong>
                    <p>{{ rec.problem }}</p>
                  </div>
                  <div class="rec-action-section">
                    <strong><mat-icon>build</mat-icon> Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡:</strong>
                    <p>{{ rec.action }}</p>
                  </div>
                  <div class="rec-result-section">
                    <strong><mat-icon>check_circle</mat-icon> Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:</strong>
                    <p>{{ rec.expected_result }}</p>
                  </div>
                  <div class="rec-difficulty-section">
                    <strong>Ø§Ù„ØµØ¹ÙˆØ¨Ø©:</strong>
                    <span [class]="'difficulty-badge difficulty-' + rec.implementation_difficulty.toLowerCase()">
                      {{ rec.implementation_difficulty }}
                    </span>
                  </div>
                </mat-card-content>
              </mat-card>
              }
            </div>
          </div>
        </mat-tab>

      </mat-tab-group>
    </mat-card>
  </div>
  }

  <!-- ========================================== -->
  <!-- SUMMARY REPORT (LIGHTWEIGHT) -->
  <!-- ========================================== -->
  @if (summaryReport() && !loading()) {
  <div class="report-content" id="report-content">
    <mat-card class="summary-report-main-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>summarize</mat-icon>
          Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>

        <div class="summary-stats-grid">
          <div class="summary-stat-item">
            <span class="stat-item-label">ØµØ­Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</span>
            <span class="stat-item-value">{{ formatCurrency(summaryReport()!.profit_health) }} Ø¬.Ù…</span>
          </div>
          <div class="summary-stat-item">
            <span class="stat-item-label">Ø§Ù„Ø±Ø¨Ø­ / ÙƒØ¬Ù…</span>
            <span class="stat-item-value">{{ formatCurrency(summaryReport()!.profit_per_kg) }} Ø¬.Ù…</span>
          </div>
          <div class="summary-stat-item negative">
            <span class="stat-item-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ³Ø±Ø¨</span>
            <span class="stat-item-value">{{ formatCurrency(summaryReport()!.total_leakage) }} Ø¬.Ù…</span>
          </div>
        </div>

        <div class="executive-summary-section">
          <div class="health-indicator">
            <span class="label">Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­:</span>
            <span
              [class]="'health-badge ' + getHealthColorClass(summaryReport()!.executive_summary.current_profit_health)">
              {{ summaryReport()!.executive_summary.current_profit_health }}
            </span>
          </div>

          <div class="summary-lists-grid">
            <div class="summary-list success">
              <h5><mat-icon>check_circle</mat-icon> Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©</h5>
              <ul>
                @for (strength of summaryReport()!.executive_summary.key_strengths; track strength) {
                <li>{{ strength }}</li>
                }
              </ul>
            </div>

            <div class="summary-list warning">
              <h5><mat-icon>warning</mat-icon> Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù</h5>
              <ul>
                @for (weakness of summaryReport()!.executive_summary.key_weaknesses; track weakness) {
                <li>{{ weakness }}</li>
                }
              </ul>
            </div>
          </div>

          <div class="potential-increase">
            <strong>Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø©:</strong>
            <span class="amount">{{ summaryReport()!.executive_summary.potential_profit_increase }}</span>
          </div>
        </div>

        <div class="top-recommendations-section">
          <h4><mat-icon>recommend</mat-icon> Ø£Ù‡Ù… Ø§Ù„ØªÙˆØµÙŠØ§Øª</h4>
          @for (rec of summaryReport()!.top_recommendations; track rec.id) {
          <div class="top-rec-item">
            <span [class]="'priority-badge ' + getPriorityClass(rec.priority)">{{ rec.priority }}</span>
            <span class="top-rec-action">{{ rec.action }}</span>
            <span class="top-rec-impact">+{{ formatCurrency(rec.profit_impact_monthly) }} Ø¬.Ù…/Ø´Ù‡Ø±</span>
          </div>
          }
        </div>

      </mat-card-content>
    </mat-card>
  </div>
  }

  <!-- ========================================== -->
  <!-- LEAKAGE REPORT -->
  <!-- ========================================== -->
  @if (leakageReport() && !loading()) {
  <div class="report-content" id="report-content">
    <mat-card class="leakage-report-main-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>troubleshoot</mat-icon>
          ØªØ­Ù„ÙŠÙ„ ØªØ³Ø±Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>

        <div class="leakage-overview-grid">
          <div class="leakage-total-item negative">
            <span class="leakage-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ³Ø±Ø¨ Ø§Ù„Ù…Ø­Ø¯Ø¯:</span>
            <span class="leakage-value">{{ formatCurrency(leakageReport()!.leakage_analysis.total_identified_leakage) }}
              Ø¬.Ù…</span>
          </div>
          <div class="leakage-percentage-item">
            <span class="leakage-label">Ù†Ø³Ø¨Ø© Ù…Ù† Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù…Ø­ØªÙ…Ù„:</span>
            <span class="leakage-value">{{
              formatPercentage(leakageReport()!.leakage_analysis.leakage_as_percent_of_potential_profit) }}</span>
          </div>
        </div>

        <h4 class="section-title"><mat-icon>list</mat-icon> Ù…ØµØ§Ø¯Ø± Ø§Ù„ØªØ³Ø±Ø¨</h4>
        @for (source of leakageReport()!.leakage_analysis.leakage_sources; track source.source) {
        <mat-card class="leakage-source-detail-card">
          <mat-card-header>
            <mat-card-title>
              <span class="source-type-text">{{ source.source }}</span>
              <span class="source-amount-text negative">-{{ formatCurrency(source.leakage_amount) }} Ø¬.Ù…</span>
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <p class="source-explanation-text">{{ source.explanation }}</p>
            <div class="source-action-box">
              <mat-icon>lightbulb</mat-icon>
              <strong>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</strong> {{ source.action }}
            </div>
          </mat-card-content>
        </mat-card>
        }

        @if (leakageReport()!.leakage_analysis.quick_wins.length > 0) {
        <mat-card class="quick-wins-section-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>flash_on</mat-icon>
              ÙÙˆØ² Ø³Ø±ÙŠØ¹
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @for (win of leakageReport()!.leakage_analysis.quick_wins; track win.action) {
            <div class="quick-win-detail-item">
              <div class="win-header-detail">
                <span [class]="'difficulty-badge difficulty-' + win.difficulty.toLowerCase()">{{ win.difficulty
                  }}</span>
                <span class="win-savings-detail">{{ formatCurrency(win.estimated_monthly_savings) }} Ø¬.Ù…/Ø´Ù‡Ø±</span>
              </div>
              <p class="win-action-text">{{ win.action }}</p>
            </div>
            }
          </mat-card-content>
        </mat-card>
        }

      </mat-card-content>
    </mat-card>
  </div>
  }

  <!-- ========================================== -->
  <!-- PARTNER DISTRIBUTION REPORT -->
  <!-- ========================================== -->
  @if (partnerDistribution() && !loading()) {
  <div class="report-content" id="report-content">

    <!-- Summary Metrics Cards -->
    <div class="metrics-grid">
      <mat-card class="metric-card">
        <mat-icon class="metric-icon">groups</mat-icon>
        <div class="metric-content">
          <h4>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡</h4>
          <p class="metric-value">{{ formatNumber(partnerDistribution()!.summary.overview.total_partners, 0) }}</p>
        </div>
      </mat-card>

      <mat-card class="metric-card">
        <mat-icon class="metric-icon">attach_money</mat-icon>
        <div class="metric-content">
          <h4>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…ÙˆØ²Ø¹Ø©</h4>
          <p class="metric-value">{{ formatCurrency(partnerDistribution()!.summary.overview.total_profit_distributed) }}
          </p>
        </div>
      </mat-card>

      <mat-card class="metric-card">
        <mat-icon class="metric-icon">event</mat-icon>
        <div class="metric-content">
          <h4>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h4>
          <p class="metric-value">{{ formatNumber(partnerDistribution()!.summary.overview.total_operations, 0) }}</p>
        </div>
      </mat-card>

      <mat-card class="metric-card">
        <mat-icon class="metric-icon">trending_up</mat-icon>
        <div class="metric-content">
          <h4>Ù…ØªÙˆØ³Ø· Ø¹Ø§Ø¦Ø¯ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</h4>
          <p class="metric-value">{{ formatPercentage(partnerDistribution()!.summary.roi_analysis.average_roi * 100, 1)
            }}</p>
        </div>
      </mat-card>
    </div>

    <!-- Top Earners -->
    @if (partnerDistribution()!.summary.top_earners.length > 0) {
    <mat-card class="top-earners-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>emoji_events</mat-icon>
          Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="top-earners-list">
          @for (earner of partnerDistribution()!.summary.top_earners; track earner.partner_name; let i = $index) {
          <div class="top-earner-item">
            <div class="rank">
              @if (i === 0) {
              <span class="medal gold">ğŸ¥‡</span>
              } @else if (i === 1) {
              <span class="medal silver">ğŸ¥ˆ</span>
              } @else if (i === 2) {
              <span class="medal bronze">ğŸ¥‰</span>
              } @else {
              <span class="rank-number">{{ formatNumber(i + 1, 0) }}</span>
              }
            </div>
            <div class="earner-info">
              <strong>{{ earner.partner_name }}</strong>
              <span class="profit-amount">{{ formatCurrency(earner.total_profit) }} Ø¬Ù†ÙŠÙ‡</span>
              <span class="profit-percentage">({{ formatPercentage(earner.percentage_of_total, 1) }} Ù…Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ)</span>
            </div>
          </div>
          }
        </div>
      </mat-card-content>
    </mat-card>
    }

    <!-- Partners Table -->
    <mat-card class="table-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>table_chart</mat-icon>
          ØªÙØ§ØµÙŠÙ„ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙŠÙƒ</th>
                <th>Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</th>
                <th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</th>
                <th>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙŠÙˆÙ…ÙŠ</th>
                <th>Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</th>
                <th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
              </tr>
            </thead>
            <tbody>
              @for (partner of partnerDistribution()!.partners; track partner.partner_id) {
              <tr>
                <td>
                  <div class="partner-name-cell">
                    @if (partner.vehicles_owned_count > 0) {
                    <mat-icon class="vehicle-icon">local_shipping</mat-icon>
                    }
                    <strong>{{ partner.partner_name }}</strong>
                  </div>
                </td>
                <td>{{ formatPercentage(partner.investment_percentage, 1) }}</td>
                <td class="profit-cell">
                  <strong>{{ formatCurrency(partner.total_final_profit) }}</strong> Ø¬Ù†ÙŠÙ‡
                </td>
                <td>{{ formatCurrency(partner.avg_daily_profit) }} Ø¬Ù†ÙŠÙ‡</td>
                <td>
                  <div class="participation-cell">
                    <div class="progress-bar">
                      <div class="progress-fill" [style.width.%]="partner.vehicle_participation_rate"
                        [class.high]="partner.vehicle_participation_rate > 50"
                        [class.low]="partner.vehicle_participation_rate <= 50">
                      </div>
                    </div>
                    <span class="percentage-label">{{ formatPercentage(partner.vehicle_participation_rate, 0) }}</span>
                  </div>
                </td>
                <td>
                  <span [class]="'badge ' + getPerformanceBadgeClass(partner.performance_rating)">
                    {{ partner.performance_rating }}
                  </span>
                </td>
                <td>
                  <button mat-icon-button (click)="viewPartnerDetails(partner)" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                    <mat-icon>visibility</mat-icon>
                  </button>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  }

  <!-- ========================================== -->
  <!-- PARTNER DETAILS MODAL -->
  <!-- ========================================== -->
  @if (selectedPartner() && showPartnerDetails()) {
  <div class="modal-overlay" (click)="closePartnerDetails()">
    <mat-card class="modal-content partner-details-modal" (click)="$event.stopPropagation()">
      <mat-card-header class="modal-header">
        <mat-card-title>
          <span>ØªÙØ§ØµÙŠÙ„ Ø£Ø±Ø¨Ø§Ø­: {{ selectedPartner()!.partner_name }}</span>
          <button mat-icon-button class="close-button" (click)="closePartnerDetails()">
            <mat-icon>close</mat-icon>
          </button>
        </mat-card-title>
      </mat-card-header>

      <mat-card-content class="modal-body">
        <!-- Partner Info -->
        <div class="partner-info-section">
          <h4>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø±ÙŠÙƒ</h4>
          <div class="partner-info-grid">
            <div class="info-item">
              <label>Ù…Ø¨Ù„Øº Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±:</label>
              <span>{{ formatCurrency(selectedPartner()!.investment_amount) }} Ø¬Ù†ÙŠÙ‡</span>
            </div>
            <div class="info-item">
              <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±:</label>
              <span>{{ formatPercentage(selectedPartner()!.investment_percentage, 1) }}</span>
            </div>
            <div class="info-item">
              <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø§Ù„Ù…Ù…Ù„ÙˆÙƒØ©:</label>
              <span>{{ formatNumber(selectedPartner()!.vehicles_owned_count, 0) }}</span>
            </div>
            <div class="info-item">
              <label>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</label>
              <span [class]="'badge ' + getPerformanceBadgeClass(selectedPartner()!.performance_rating)">
                {{ selectedPartner()!.performance_rating }}
              </span>
            </div>
          </div>
        </div>

        <!-- Insights -->
        @if (selectedPartner()!.details?.insights && selectedPartner()!.details!.insights.length > 0) {
        <div class="insights-section">
          <h4><mat-icon>lightbulb</mat-icon> Ø±Ø¤Ù‰ ÙˆØªÙˆØµÙŠØ§Øª</h4>
          @for (insight of selectedPartner()!.details!.insights; track insight.message) {
          <div [class]="'insight-item insight-' + insight.type">
            <span class="insight-icon">{{ getInsightIcon(insight.type) }}</span>
            <p>{{ insight.message }}</p>
          </div>
          }
        </div>
        }

        <!-- Daily Breakdown -->
        @if (selectedPartner()!.daily_breakdown && selectedPartner()!.daily_breakdown.length > 0) {
        <div class="daily-breakdown-section">
          <h4><mat-icon>calendar_today</mat-icon> Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h4>
          <div class="table-container">
            <table class="daily-breakdown-table">
              <thead>
                <tr>
                  <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                  <th>Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</th>
                  <th>Ø®ØµÙ… ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</th>
                  <th>Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</th>
                  <th>Ù…Ø´Ø§Ø±Ùƒ ÙÙŠ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</th>
                </tr>
              </thead>
              <tbody>
                @for (day of selectedPartner()!.daily_breakdown; track day.date) {
                <tr>
                  <td>{{ formatDateTime(day.date) }}</td>
                  <td>{{ formatCurrency(day.base_share) }} Ø¬Ù†ÙŠÙ‡</td>
                  <td>{{ formatCurrency(day.vehicle_cost_deduction) }} Ø¬Ù†ÙŠÙ‡</td>
                  <td class="profit-cell">
                    <strong>{{ formatCurrency(day.final_profit) }}</strong> Ø¬Ù†ÙŠÙ‡
                  </td>
                  <td class="text-center">
                    @if (day.is_vehicle_partner) {
                    <mat-icon class="status-icon-success">check_circle</mat-icon>
                    } @else {
                    <mat-icon class="status-icon-error">cancel</mat-icon>
                    }
                  </td>
                </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
        }
      </mat-card-content>
    </mat-card>
  </div>
  }

</div>
